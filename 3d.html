<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first Three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="three.js"></script>
		<script>
			function quick_sort(array, start, end) {
				console.log(array, start, end);
				if(end > start) {
					var wall = partition(array, start, end);
					quick_sort(array, start, wall-1);
					quick_sort(array, wall+1, end);
				}
			}

			function partition(array, start, end) {
				console.log(array, start, end);
				var wall = start;
				var temp;
				for(var i = start; i < end; i++) {
					if(smaller_than(array[i], array[end])) {
//						temp = array[wall];
//						array[wall] = array[i];
//						array[i] = temp;
						swap(array[wall], array[i]);
						wall++;
					}
				}
//				temp = array[wall];
//				array[wall] = array[end];
//				array[end] = temp;
				swap(array[wall], array[end]);
				return wall;
			}

			function smaller_than(cube1, cube2) {
				return cube1.geometry.parameters.height < cube2.geometry.parameters.height;
			}

			function swap(cube1, cube2) {
				var x = cube1.position.x;
				var y = cube1.position.y;
				var z = cube1.position.z;
//				console.log(temp);
				cube1.position.set(cube2.position.x, cube2.position.y, cube2.position.z);
				cube2.position.set(x, y, z);
			}

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
			var renderer = new THREE.WebGLRenderer();
			var columns = [];

			// add a column to scene
			function create_column(scene, columns, pos, height) {
				var geometry = new THREE.BoxGeometry( 0.5, height, 0.5 );
				var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
				var cube = new THREE.Mesh( geometry, material );
				cube.position.set(pos[0], pos[1], pos[2]);
				columns.push(cube);
				scene.add( cube );
			}

			var i = 0;
			function sort(columns) {
				if (i == 50) {
//					columns[0].position.set(-4, 0, 0);
					quick_sort(columns, 0, columns.length-1);
				}
				i++;
			}

			create_column(scene, columns, [0,0,0], 3);
			create_column(scene, columns, [2,0,0], 2);
			create_column(scene, columns, [-2,0,0], 1);

			function render() {
				requestAnimationFrame( render );
				renderer.render( scene, camera );
//				cube.rotation.x += 0.01;
				// cube.rotation.y += 0.01;
				sort(columns);
			}

			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );


			camera.position.z = 5;


			render();


		</script>
	</body>
</html>
