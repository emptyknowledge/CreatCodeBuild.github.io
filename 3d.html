<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first Three.js app</title>
		<style>
			body { margin: 0; }
			canvas {
        width: 90%;
        height: 90%
      }
		</style>
		<script src="js/three.js"></script>
		<script src="js/FirstPersonControls.js"></script>
		<script src="js/algorithm.js"></script>
		<script src="js/model.js"></script>
	</head>
	<body>

	<script>
		/* 3D */
		function init_columns(numColumns) {
			var columnsModel = ColumnsModel(2, -numColumns);
			for(var i = 0; i < numColumns; i++) {
				columnsModel.create_column(Math.floor(Math.random() * (100)) + 1);
			}
			return columnsModel;
		}

		function add_all_to(scene, columns) {
			for(var i in columns) {
				scene.add(columns[i]);
			}
		}

		/* Start */
		var controls;
		var scene;
		var camera;
		var renderer;

		scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
		renderer = new THREE.WebGLRenderer();
		renderer.setSize( window.innerWidth, window.innerHeight );

		document.body.appendChild( renderer.domElement );
//		camera.position.z = 300;

		// models
		var columnsModel = init_columns(250);
		add_all_to(scene, columnsModel.columns);

		var quickSortGenerator = Algorithm.quick_sort(columnsModel.columns, 0, columnsModel.columns.length-1, swap, smaller_than);
		// var mergeSortGenerator = Algorithm.merge_sort(columnsModel.columns, move_to, smaller_than);

		// key, user interaction
		document.onkeypress = function(evt) {
			evt = evt || window.event;
			var charCode = evt.keyCode || evt.which;
			var charStr = String.fromCharCode(charCode);
			console.log(charStr);
			switch(charStr) {
				case 'v':
          //todo: if the browser support
          var element = document.body;
          element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;
          element.requestPointerLock();
          controls.enabled = true;
					break;
			}
		};

		THREE.FirstPersonControls(camera);
		controls = new THREE.FirstPersonControls( camera );
		controls.movementSpeed = 100;
		controls.lookSpeed = 100;
		controls.noFly = true;
		controls.lookVertical = true;
    controls.enabled = false;

		var clock = new THREE.Clock();
		(function render() {
			requestAnimationFrame( render );
			renderer.render( scene, camera );
			quickSortGenerator.next();
			columnsModel.justify_position();
			controls.update( clock.getDelta());
		})();

    // Ask the browser to lock the pointer
	</script>
	</body>
</html>
